# 인풋 이미지(웹캠)
input_stream: "input_video"


# 아웃풋 이미지(최종 출력 결과물)
output_stream: "output_video"

# 랜드마크 정보
output_stream: "face_landmarks_with_iris"
output_stream: "face_rect"
output_stream: "face_detections"


# 한 개의 얼굴만을 탐지하도록 변수를 고정
node {
	calculator: "ConstantSidePacketCalculator"
	output_side_packet: "PACKET:0:num_faces"
	node_options: {
		[type.googleapis.com/mediapipe.ConstantSidePacketCalculatorOptions] {
			packet { int_value: 1 }
		}
	}
}

# 인풋 영상을 가로로 뒤집어 출력
node{
	calculator: "ImageTransformationCalculator"
	input_stream: "IMAGE:input_video"
	output_stream: "IMAGE:output_video"
	node_options: {
		[type.googleapis.com/mediapipe.ImageTransformationCalculatorOptions] {
			flip_vertically: true
			flip_horizontally: true
		}
	}
}

# 얼굴, 반응하는 랜드마크 탐지
node {
	calculator: "FaceLandmarkFrontCpu"
	input_stream: "IMAGE:output_video"
	input_side_packet: "NUM_FACES:num_faces"
	output_stream: "LANDMARKS:multi_face_landmarks"
	output_stream: "ROIS_FROM_LANDMARKS:face_rects_from_landmarks"
	output_stream: "DETECTIONS:face_detections"
	output_stream: "ROIS_FROM_DETECTIONS:face_rects_from_detections"
}

# 제일 처음 인식된 하나의 얼굴 랜드마크 추출
node {
	calculator: "SplitNormalizedLandmarkListVectorCalculator"
	input_stream: "multi_face_landmarks"
	output_stream: "face_landmarks"
	node_options: {
		 [type.googleapis.com/mediapipe.SplitVectorCalculatorOptions] {
			ranges: { begin: 0 end: 1 }
			element_only: true
		 }
	}
}

# 제일 처음 인식된 하나의 얼굴 rect만 추출
node {
	calculator: "SplitNormalizedRectVectorCalculator"
	input_stream: "face_rects_from_landmarks"
	output_stream: "face_rect"
	node_options: {
		[type.googleapis.com/mediapipe.SplitVectorCalculatorOptions] {
			ranges: { begin: 0 end: 1 }
			element_only: true
		}
	}
}

# 눈 랜드마크 추적
node {
	calculator: "IrisLandmarksFromFaceLandmarksCpu"
	input_stream: "IMAGE:output_video"
	input_stream: "FACE_LANDMARKS:face_landmarks"
	output_stream: "UPDATED_FACE_LANDMARKS:updated_face_landmarks"
	output_stream: "LEFT_EYE_IRIS_LANDMARKS:left_iris_landmarks"
	output_stream: "RIGHT_EYE_IRIS_LANDMARKS:right_iris_landmarks"
}

# 좌우 눈 랜드마크와 얼굴 랜드마크를 연결
node {
	calculator: "ConcatenateNormalizedLandmarkListCalculator"
	input_stream: "updated_face_landmarks"
	input_stream: "left_iris_landmarks"
	input_stream: "right_iris_landmarks"
	output_stream: "face_landmarks_with_iris"
}
